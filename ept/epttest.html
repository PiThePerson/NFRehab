<!DOCTYPE html>
<html>
  <head>
    <title>Basic Pose Detection</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial;
      }
      canvas {
        display: block;
        margin-top: 20px;
        border: 2px solid #333;
      }
    </style>
  </head>
  <body>
    <h1>Basic Pose Detection</h1>
    <p>Camera feed with MediaPipe pose landmarks</p>
    <canvas id="output" width="640" height="480"></canvas>

    <!-- MediaPipe Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

    <script>
      // Initialize elements
      const canvas = document.getElementById("output");
      const ctx = canvas.getContext("2d");
      const video = document.createElement("video");

      // Create Pose detector
      const pose = new Pose({
        locateFile: (file) =>
          `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`,
      });

      pose.setOptions({
        modelComplexity: 1,
        smoothLandmarks: true,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5,
      });

      pose.onResults(drawResults);

      // Start camera
      async function startCamera() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: {
              width: { ideal: 640 },
              height: { ideal: 480 },
              facingMode: "user",
            },
            audio: false,
          });
          video.srcObject = stream;
          await video.play();
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          processFrame();
        } catch (err) {
          console.error("Camera error:", err);
          alert("Could not access camera: " + err.message);
        }
      }

      // Process each frame
      function processFrame() {
        // Draw video frame (mirrored)
        ctx.save();
        ctx.scale(-1, 1);
        ctx.translate(-canvas.width, 0);
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        ctx.restore();

        // Send frame to pose detection
        if (video.readyState >= 2) {
          pose.send({ image: video });
        }
        requestAnimationFrame(processFrame);
      }

      // Draw pose landmarks
      function drawResults(results) {
        if (results.poseLandmarks) {
          ctx.save();
          ctx.scale(-1, 1);
          ctx.translate(-canvas.width, 0);

          // Draw all pose landmarks and connections
          drawConnectors(ctx, results.poseLandmarks, POSE_CONNECTIONS, {
            color: "#00FF00",
            lineWidth: 2,
          });
          drawLandmarks(ctx, results.poseLandmarks, {
            color: "#FF0000",
            radius: 3,
          });

          ctx.restore();
        }
      }

      // Start everything when page loads
      window.addEventListener("load", startCamera);
    </script>
  </body>
</html>
